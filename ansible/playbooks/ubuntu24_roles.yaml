# Ansible playbook for a standard Ubuntu 24.04 development machine
- name: ubuntu 24.04 setup
  hosts: ubuntu
  gather_facts: true
  roles:
    - generic
  tasks:
    - name: core ubuntu setup
      become: true
      block:
        - name: apt update and upgrade
          ansible.builtin.apt:
            upgrade: true
        - name: install packages via apt
          ansible.builtin.apt:
            name:
              - ubuntu-advantage-tools
              - build-essential
              - cmake
              - openssh-server
              - git
              - curl
              - python3-venv
              - dos2unix
              - xclip
              - gzip
              - scdoc
              - keychain
              - jq
        - name: system wide sudo configuration
          ansible.builtin.template:
            src: ../templates/sudoers.j2
            dest: /etc/sudoers.d/{{ansible_user_id}}
            owner: root
            group: root
            mode: "0600"
            validate: /usr/sbin/visudo -cf %s
          vars:
            sudo_timestamp_timeout: 60
            sudo_passwd_tries: 3
        - name: system wide sshd configuration
          ansible.builtin.template:
            src: ../templates/sshd.conf.j2
            dest: /etc/ssh/sshd_config.d/{{ansible_user_id}}.conf
            owner: root
            group: root
            mode: "0600"
            validate: /usr/sbin/sshd -t -f %s
          vars:
            sshd_permit_root_login: "no"
            sshd_password_authentication: "no"
            sshd_client_alive_interval: 60
            sshd_client_alive_count_max: 60
        - name: remove pre-installed ssh config
          ansible.builtin.file:
            path: /etc/ssh/sshd_config.d/50-cloud-init.conf
            state: absent
        - name: remove sudo hint from bashrc
          ansible.builtin.command: sed -i -e '/sudo hint/,+11 s/^/#/' /etc/bash.bashrc
        - name: remove the legal quips from motd
          ansible.builtin.file:
            path: /etc/legal
            state: absent
        - name: Change file ownership, group and permissions
          ansible.builtin.file:
            path: /etc/update-motd.d/10-help-text
            mode: "0655"
        - name: create XDG folders
          become: false
          ansible.builtin.file:
            path: ~/{{ item }}
            state: directory
            mode: 0700
          loop:
            - .config
            - .local
            - .local/bin
            - .local/share
